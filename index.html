<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Document</title>
    <script
      type="module"
      src="./js/main.js"
      defer
    ></script>
    <link
      rel="stylesheet"
      href="style.css"
    />
  </head>
  <body>
    <!-- Вкладки -->
    <div class="tabs">
      <div id="first__tab">Перша вкладка</div>
      <div id="second__tab">Друга вкладка</div>
    </div>
    <!--Перший таб-->
    <div class="date">
      <div class="date__container">
        <form class="date__form">
          <div class="date__inputs">
            <h2>Виберіть Початок дати</h2>
            <input
              type="date"
              class="start-date"
            />
            <h2>Виберіть кінцеву дату</h2>
            <input
              type="date"
              class="end-date"
              disabled
            />
          </div>
          <div class="option__preset">
            <h2>Оберіть пресет</h2>
            <button
              class="preset__week"
              type="button"
            >
              тиждень
            </button>
            <button
              class="preset__month"
              type="button"
            >
              місяць
            </button>
          </div>
          <div class="date__options">
            <div class="option__days">
              <select
                name=""
                id="days__dimension"
              >
                <option value="all-days">Всі дні</option>
                <option value="working-days">Будні дні</option>
                <option value="weekends">Вихідні дні</option>
              </select>
            </div>
            <div class="option__time">
              <select
                name=""
                id="time__dimension"
              >
                <option value="days">Порахувати кількість днів</option>
                <option value="hours">Порахувати кількість годин</option>
                <option value="minutes">Порахувати кількість хвилин</option>
                <option value="seconds">Порахувати кількість секунд</option>
              </select>
            </div>
          </div>
          <div>
            <button
              class="date__button"
              type="submit"
            >
              Розрахувати дату
            </button>
          </div>
          <div class="date__result"></div>
        </form>
      </div>
      <div class="stored-results">
        <table>
          <thead>
            <tr>
              <th>Початкова дата</th>
              <th>Кінцева дата</th>
              <th>Результат</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
        </table>
      </div>
    </div>
    <!--Другий таб-->
    <div
      class="countries"
      hidden
    >
      <div>
        <label for="countries__select">Вибір країни:</label>
        <select id="countries__select">
          <option value="">Оберіть країну</option>
        </select>
      </div>

      <div>
        <label for="year__select">Вибір року:</label>
        <select id="year__select">
          <option value="">Виберіть рік</option>
        </select>
      </div>

      <button class="holiday__button">Отримати свята</button>

      <table id="holidays-table">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Назва свята</th>
            <th>
              <button
                id="sort-holidays"
              >
                Сортувати
              </button>
            </th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="error-message"></div>

      <script>
        const API_KEY = 'SWHjQHpfQZSjn5JXbaF5FtgWnm0dEMJl'
        const API_URL = 'https://calendarific.com/api/v2/'

        const countriesSelect = document.getElementById('countries__select')
        const yearSelect = document.getElementById('year__select')
        const holidaysTableBody = document.querySelector(
          '#holidays-table tbody'
        )
        const errorMessageContainer = document.getElementById('error-message')
        const getHolidaysButton = document.querySelector('.holiday__button')
        const sortButton = document.getElementById('sort-holidays')

        async function getCountries() {
          try {
            const response = await fetch(
              `${API_URL}countries?api_key=${API_KEY}`
            )
            const data = await response.json()
            return data.response.countries
          } catch (error) {
            throw error
          }
        }

        async function getHolidays(country, year) {
          try {
            const response = await fetch(
              `${API_URL}holidays?api_key=${API_KEY}&country=${country}&year=${year}`
            )
            const data = await response.json()
            return data.response.holidays
          } catch (error) {
            throw error
          }
        }
        async function populateCountriesDropdown() {
          try {
            const countries = await getCountries()
            countries.forEach((country) => {
              let countryOption = document.createElement('option')
              countryOption.textContent = country.country_name
              countryOption.value = country['iso-3166']
              countriesSelect.append(countryOption)
            })
          } catch (error) {
            displayErrorMessage('Не вдалося отримати країни')
          }
        }

        function populateYearsDropdown() {
          for (let year = 2001; year <= 2049; year++) {
            const option = document.createElement('option')
            option.value = year
            option.text = year
            yearSelect.add(option)
          }
        }

        async function getAndDisplayHolidays() {
          const selectedCountry = countriesSelect.value
          const selectedYear = yearSelect.value

          if (!selectedCountry || !selectedYear) {
            displayErrorMessage('Оберіть країну та рік!')
            return
          }

          holidaysTableBody.innerHTML = ''

          try {
            const holidays = await getHolidays(selectedCountry, selectedYear)
            displayHolidays(holidays)
          } catch (error) {
            displayErrorMessage('Не вдалося отримати свята.')
          }
        }

        function displayHolidays(holidays) {
          holidays.forEach((holiday) => {
            const row = holidaysTableBody.insertRow()
            const dateCell = row.insertCell(0)
            const nameCell = row.insertCell(1)

            dateCell.textContent =
              holiday.date.iso || holiday.date.date || holiday.date
            nameCell.textContent = holiday.name
          })
        }

        function displayErrorMessage(message) {
          errorMessageContainer.textContent = message
          errorMessageContainer.style.display = 'block'
        }
        let ascendingOrder = true

        function sortHolidays() {
          const tableBody = document.querySelector('#holidays-table tbody')
          const rows = Array.from(tableBody.querySelectorAll('tr'))

          rows.sort((row1, row2) => {
            const date1 = new Date(row1.cells[0].textContent)
            const date2 = new Date(row2.cells[0].textContent)

            return ascendingOrder ? date1 - date2 : date2 - date1
          })

          tableBody.innerHTML = ''

          rows.forEach((row) => {
            tableBody.appendChild(row)
          })

          ascendingOrder = !ascendingOrder
        }

        document.addEventListener('DOMContentLoaded', async () => {
          await populateCountriesDropdown()
          populateYearsDropdown()
          sortButton.addEventListener('click', sortHolidays)

          getHolidaysButton.addEventListener('click', async () => {
            await getAndDisplayHolidays()
          })
        })
      </script>
    </div>
  </body>
</html>
